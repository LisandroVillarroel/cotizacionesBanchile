<app-cabecera-popup [titulo]="'Detalle de solicitud - ' + this.idSolicitud" />
<mat-dialog-content class="p-0">
  <mat-card>
    <mat-card-content>
      <mat-tab-group>
        <mat-tab label="Información General">
          <div class="container-fluid mt-5">
            <app-informacion-general [infoGral]="infoGral()" />

            <!-- Lista observaciones -->
            <div class="container-fluid" style="padding: 0px 0px 12px">
              @if(observaciones()?.length!==0 && observaciones()!==undefined){
              <mat-expansion-panel
                class="mat-elevation-z6"
                style="
                  border-radius: 10px;
                  border: 1px solid;
                  border-color: #234e85;
                  padding: 4px;
                "
                (opened)="panelOpenState = true"
                (closed)="panelOpenState = false"
              >
                <mat-expansion-panel-header>
                  <mat-panel-title class="destacado">
                    Observaciones
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <app-observaciones [observaciones]="observaciones()" />
              </mat-expansion-panel>
              }
            </div>

            <!-- Lista compañías contactadas -->
            <div class="container-fluid" style="padding: 0px 0px 12px">
              @if(companias()?.length!==0 && companias()!==undefined){
              <mat-expansion-panel
                class="mat-elevation-z6"
                style="
                  border-radius: 10px;
                  border: 1px solid;
                  border-color: #234e85;
                "
                (opened)="panelOpenState2 = true"
                (closed)="panelOpenState2 = false"
              >
                <mat-expansion-panel-header>
                  <mat-panel-title class="destacado">
                    Compañías Contactadas
                  </mat-panel-title>
                  <!--                   <div class="msj-warning">
                    <h3><mat-icon>info</mat-icon>
                      Se requiere contactar un mínimo de {{minimo}} compañías para esta solicitud.
                    </h3>
                  </div> -->
                </mat-expansion-panel-header>

                <app-companias-contactadas
                  [infoGral]="infoGral()"
                  [companias]="companias()"
                  [verEjec]="verEjec"
                  [verCoord]="verCoord"
                  [minimo]="minimo"
                  [flagSoloCerrar]="flagSoloCerrar"
                  (actualizarDatos)="
                    cargarCompanias(idSolicitud);
                    obtenerMinimo(idSolicitud);
                    cargarSolicitud(idSolicitud)
                  "
                  [cotizacionSeleccionada]="cotizacionSeleccionada"
                  (cotizacionSeleccionadaEvent)="
                    cotizacionSeleccionada = $event
                  "
                  (cargaRespuesta)="
                    cargarSolicitud(idSolicitud);
                    cargarCompanias(idSolicitud);
                    obtenerMinimo(idSolicitud)
                  "
                />
              </mat-expansion-panel>

              }
            </div>
          </div>
        </mat-tab>
        <mat-tab label="Asegurados">
          <div class="container-fluid">
            <app-asegurado
              [idSolicitud]="idSolicitud"
              [mostrarSoloConsulta]="soloConsulta()"
            />
          </div>
        </mat-tab>
        <mat-tab label="Beneficiarios">
          <div class="container-fluid">
            <!-- <app-beneficiario [idSolicitud]="idSol()" /> -->
            <app-beneficiario
              [idSolicitud]="idSolicitud"
              [mostrarSoloConsulta]="soloConsulta()"
            />
          </div>
        </mat-tab>
        <mat-tab label="Materia Asegurada">
          <app-materia-asegurada
            [idSolicitud]="idSolicitud"
            [idRubro]="infoGral()?.id_rubro!"
            [idSeguro]="infoGral()?.id_tipo_seguro!"
            [muestraConsulta]="soloConsulta()"
          />
        </mat-tab>
        <mat-tab label="Documentos Asociados">
          <div class="container-fluid">
            <app-cuestionario-documentos [idSolicitud]="idSolicitud" />
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</mat-dialog-content>
<mat-dialog-actions style="align-content: end">
  <div class="container-fluid d-flex p-4 mb-0">
    <div style="justify-content: flex-start">
      <button
        mat-stroked-button
        color="primary"
        class="colorFondoBotonSalir"
        mat-dialog-close
        [disabled]="false"
      >
        Cerrar
      </button>
    </div>
    <div class="botones-derecha" *ngIf="!flagSoloCerrar">
      <button
        mat-stroked-button
        class="btn-danger"
        [hidden]="this.flagAnular"
        (click)="anularSolicitud()"
      >
        Anular Solicitud
      </button>

      <button
        mat-stroked-button
        class="btn-primary"
        [disabled]="this.flagCoordinador"
        [hidden]="this.verCoord"
        (click)="enviarCoordinador()"
      >
        Enviar a Coordinador
      </button>

      <button
        mat-stroked-button
        class="btn-warning"
        [hidden]="this.flagDevolver || this.verEjec"
        (click)="devolverSolicitud()"
      >
        Devolver solicitud
      </button>

      <button
        mat-stroked-button
        class="btn-success"
        [hidden]="this.flagAprobar || this.verEjec"
        (click)="aprobarSolicitud()"
      >
        Aprobar Solicitud
      </button>

      <button
        mat-stroked-button
        class="btn-info"
        [disabled]="this.flagCompania"
        [hidden]="this.verEjec || this.flagCompania"
        (click)="agregarCompania()"
      >
        Agregar Compañía
      </button>

      <button
        mat-stroked-button
        class="btn-info"
        [hidden]="this.flagCotizacion || this.verEjec"
        [disabled]="this.puedeEnviar"
        (click)="enviarCia()"
      >
        Enviar a Compañía(s)
      </button>

      <button
        mat-stroked-button
        class="btn-primary"
        [hidden]="this.flagPropuesta || this.verCoord"
        (click)="crearPropuesta()"
      >
        Generar Propuesta
      </button>

      <button
      mat-stroked-button
      class="btn-success"
      [hidden]="flagAprobarCot || verCoord"
      [disabled]="!cotizacionSeleccionada"
      (click)="aprobarCotizacion()"
      >
        Aprobar Cotización
      </button>
    </div>
  </div>
</mat-dialog-actions>
